<head>
  <meta charset="UTF-8" />
  <title>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞</title>
  <script src="https://unpkg.com/docx@8.5.0/build/index.umd.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f8f8;
      padding: 20px;
      max-width: 800px;
      margin: auto;
      color: #333;
    }

    h2 {
      text-align: center;
      color: #f57c00;
      margin-bottom: 20px;
      font-size: 24px;
    }

    input, select, button {
      width: 100%;
      margin-bottom: 15px;
      padding: 12px 15px;
      font-size: 1em;
      border: 2px solid #ddd;
      border-radius: 8px;
      box-sizing: border-box;
    }

    input:focus, select:focus, button:focus {
      outline: none;
      border-color: #f57c00;
      box-shadow: 0 0 5px rgba(245, 124, 0, 0.4);
    }

    button {
      background-color: #f57c00;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #ff6f00;
    }

    .product {
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 15px;
      margin-bottom: 20px;
    }

    .product input {
      margin-bottom: 10px;
    }

    label {
      font-weight: bold;
      color: #333;
    }

    #products {
      margin-bottom: 20px;
    }

    .form-section {
      margin-bottom: 30px;
    }

    .form-section h3 {
      margin-bottom: 10px;
      color: #f57c00;
    }

    .form-section p {
      font-size: 14px;
      color: #888;
    }

    .table {
      width: 100%;
      margin-top: 15px;
      border-collapse: collapse;
    }

    .table th, .table td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    .table th {
      background-color: #f2f2f2;
      color: #f57c00;
    }

    .table td {
      color: #555;
    }

    .table td:last-child {
      text-align: right;
    }

    .alert {
      padding: 15px;
      margin: 10px 0;
      border-radius: 5px;
      font-weight: bold;
      display: none;
    }

    .alert.success {
      background-color: #4caf50;
      color: white;
    }

    .alert.error {
      background-color: #f44336;
      color: white;
    }

    select {
  -webkit-appearance: none; /* –£–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –≤–µ–±–∫–∏—Ç–∞ */
  -moz-appearance: none; /* –£–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è Firefox */
  appearance: none; /* –£–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –¥—Ä—É–≥–∏—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤ */
  background-color: #f9f9f9;
  border: 1px solid #ccc;
  margin-top: 10px;
  padding: 12px;
  font-size: 1em;
  border-radius: 5px;
  color: #333;

  cursor: pointer;
  transition: border-color 0.3s ease;
}

select:focus {
  outline: none;
  border-color: #ff8c42;
}

select option {
  padding: 10px;
  background-color: #ffffff;
  color: #333;
}
  </style>
</head>
  </style>
</head>
<body>

  <h2>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞</h2>
  <div class="alert success" id="successAlert">‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram!</div>
  <div class="alert error" id="errorAlert">‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ Telegram.</div>

  <form id="contractForm">
    <div class="form-section">
      <input name="contractNumber" placeholder="–ù–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä–∞" required />
      <input name="contractCode" placeholder="–ë—É–∫–≤—ã –¥–æ–≥–æ–≤–æ—Ä–∞" required />
      <input name="fullName" placeholder="–§.–ò.–û –ü–æ–∫—É–ø–∞—Ç–µ–ª—è" required />
      <input name="passport" placeholder="–ü–∞—Å–ø–æ—Ä—Ç" required />
      <input name="pinfl" placeholder="–ü–ò–ù–§–õ" required />
      <input name="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" required />
    </div>

    <div class="form-section">
      <label>–î–∞—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞:</label>
      <input type="date" name="firstPaymentDate" required />
      
      <label>–ü–µ—Ä–∏–æ–¥ —Ä–∞—Å—Å—Ä–æ—á–∫–∏ (–≤ –º–µ—Å—è—Ü–∞—Ö):</label>
      <select name="paymentPeriod" required>
        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–∏–æ–¥</option>
        <option value="3">3 –º–µ—Å—è—Ü–∞</option>
        <option value="6">6 –º–µ—Å—è—Ü–µ–≤</option>
        <option value="12">12 –º–µ—Å—è—Ü–µ–≤</option>
      </select>
    </div>

    <div class="form-section">
      <h3>–¢–æ–≤–∞—Ä—ã</h3>
      <div id="products"></div>
      <button type="button" onclick="addProduct()">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
    </div>

    <button type="submit">üì§ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </form>

  <script>
    const form = document.getElementById("contractForm");
    const productsDiv = document.getElementById("products");
    const successAlert = document.getElementById("successAlert");
    const errorAlert = document.getElementById("errorAlert");

    function addProduct() {
      const index = productsDiv.children.length;
      const wrapper = document.createElement("div");
      wrapper.className = "product";
      wrapper.innerHTML = `
        <input name="productName_${index}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞" required />
        <input name="productQty_${index}" type="number" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" required />
        <input name="productPrice_${index}" type="number" step="0.01" placeholder="–¶–µ–Ω–∞ (—Å—É–º)" required />
        <button type="button" onclick="removeProduct(${index})">–£–¥–∞–ª–∏—Ç—å</button>
      `;
      productsDiv.appendChild(wrapper);
    }

    function removeProduct(index) {
      const product = productsDiv.children[index];
      product.remove();
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Ç–æ–≤–∞—Ä–æ–≤
      updateProductIndexes();
    }

    function updateProductIndexes() {
      const allProducts = productsDiv.querySelectorAll(".product");
      allProducts.forEach((prod, i) => {
        const inputs = prod.querySelectorAll("input");
        inputs.forEach(input => {
          input.name = input.name.replace(/\d+/, i);
        });
        const removeButton = prod.querySelector("button");
        removeButton.setAttribute("onclick", `removeProduct(${i})`);
      });
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const contractNumber = formData.get("contractNumber");
      const contractCode = formData.get("contractCode");
      const fullName = formData.get("fullName");
      const passport = formData.get("passport");
      const pinfl = formData.get("pinfl");
      const phone = formData.get("phone");
      const firstPaymentDate = formData.get("firstPaymentDate");
      const period = parseInt(formData.get("paymentPeriod"));

      const items = [];
      productsDiv.querySelectorAll(".product").forEach((prod, i) => {
        items.push({
          name: formData.get(`productName_${i}`),
          qty: parseInt(formData.get(`productQty_${i}`)),
          price: parseFloat(formData.get(`productPrice_${i}`))
        });
      });

      const total = items.reduce((sum, i) => sum + i.qty * i.price, 0);
      const monthly = +(total / period).toFixed(2);

      const dates = [];
      const base = new Date(firstPaymentDate);
      for (let i = 0; i < period; i++) {
        const d = new Date(base);
        d.setMonth(d.getMonth() + i);
        dates.push(d.toLocaleDateString("ru-RU"));
      }

      const { Document, Packer, Paragraph, TextRun, Table, TableRow, TableCell } = window.docx;

      const doc = new Document({
        sections: [{
          properties: {},
          children: [
            new Paragraph({ children: [new TextRun(`–î–æ–≥–æ–≤–æ—Ä ‚Ññ${contractNumber}-${contractCode}`),] }),
            new Paragraph({ children: [new TextRun(`–§.–ò.–û: ${fullName}`)] }),
            new Paragraph({ children: [new TextRun(`–ü–∞—Å–ø–æ—Ä—Ç: ${passport}`)] }),
            new Paragraph({ children: [new TextRun(`–ü–ò–ù–§–õ: ${pinfl}`)] }),
            new Paragraph({ children: [new TextRun(`–¢–µ–ª–µ—Ñ–æ–Ω: ${phone}`)] }),
            new Paragraph({ text: " " }),
            new Paragraph("üì¶ –¢–æ–≤–∞—Ä—ã:"),
            new Table({
              rows: [
                new TableRow({
                  children: ["–ù–∞–∑–≤–∞–Ω–∏–µ", "–ö–æ–ª-–≤–æ", "–¶–µ–Ω–∞", "–°—É–º–º–∞"].map(text =>
                    new TableCell({ children: [new Paragraph(text)] })
                  )
                }),
                ...items.map(item =>
                  new TableRow({
                    children: [
                      new TableCell({ children: [new Paragraph(item.name)] }),
                      new TableCell({ children: [new Paragraph(item.qty.toString())] }),
                      new TableCell({ children: [new Paragraph(item.price.toLocaleString())] }),
                      new TableCell({ children: [new Paragraph((item.qty * item.price).toLocaleString())] }),
                    ]
                  })
                )
              ]
            }),
            new Paragraph({ text: " " }),
            new Paragraph("üí∞ –ì—Ä–∞—Ñ–∏–∫ –ø–ª–∞—Ç–µ–∂–µ–π:"),
            new Table({
              rows: [
                new TableRow({
                  children: ["#", "–î–∞—Ç–∞", "–°—É–º–º–∞"].map(text =>
                    new TableCell({ children: [new Paragraph(text)] })
                  )
                }),
                ...dates.map((d, i) =>
                  new TableRow({
                    children: [
                      new TableCell({ children: [new Paragraph((i + 1).toString())] }),
                      new TableCell({ children: [new Paragraph(d)] }),
                      new TableCell({ children: [new Paragraph(monthly.toLocaleString())] }),
                    ]
                  })
                )
              ]
            })
          ]
        }]
      });

      const blob = await Packer.toBlob(doc);
      const file = new File([blob], `–î–æ–≥–æ–≤–æ—Ä-${contractNumber}-${contractCode}.docx`);

      const tgForm = new FormData();
      tgForm.append("chat_id", "-1002564003711");  // –£–∫–∞–∂–∏ —Å–≤–æ–π ID –≥—Ä—É–ø–ø—ã
      tgForm.append("document", file);

      try {
        const response = await fetch("https://api.telegram.org/bot7513506064:AAHTgZ6K08inhCAAAKm4Sb71r-6fbBFQo4M/sendDocument", {
          method: "POST",
          body: tgForm
        });
        if (response.ok) {
          successAlert.style.display = "block";
        } else {
          errorAlert.style.display = "block";
        }
      } catch (error) {
        errorAlert.style.display = "block";
      }
    });

    
  </script>
</body>
</html>
